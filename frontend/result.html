<!DOCTYPE html>
<html lang="en">
<head>
    <!-- =======================
         META & TITLE
    ======================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipGen AI | Results</title>

    <!-- =======================
         FONTS & FRAMEWORK
    ======================== -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- =======================
         CUSTOM AI UI STYLES
    ======================== -->
    <style>
        :root{
            --primary:#6366f1;
            --secondary:#22d3ee;
            --bg:#0f172a;
            --card:#111827;
            --text:#e5e7eb;
            --muted:#9ca3af;
        }

        body{
            font-family:'Inter',sans-serif;
            background:radial-gradient(circle at top,#1e293b,#020617);
            color:var(--text);
            min-height:100vh;
            margin:0;
        }

        /* =======================
           HEADER
        ======================== */
        .top-bar{
            max-width:1300px;
            margin:24px auto;
            padding:0 20px;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .brand{
            font-weight:800;
            font-size:1.4rem;
            letter-spacing:1px;
        }

        .brand span{
            color:var(--secondary);
        }

        .back-btn{
            text-decoration:none;
            color:var(--text);
            padding:10px 18px;
            border:1px solid rgba(255,255,255,0.15);
            border-radius:12px;
            transition:.3s;
        }

        .back-btn:hover{
            background:var(--primary);
            border-color:var(--primary);
        }

        /* =======================
           LOADING CARD
        ======================== */
        .status-card{
            max-width:880px;
            margin:80px auto;
            background:linear-gradient(180deg,#020617,#020617cc);
            border-radius:28px;
            padding:60px;
            text-align:center;
            box-shadow:0 50px 120px rgba(0,0,0,0.6);
            border:1px solid rgba(255,255,255,0.08);
        }

        .loader{
            width:80px;
            height:80px;
            border-radius:50%;
            border:5px solid rgba(255,255,255,0.15);
            border-top-color:var(--secondary);
            margin:0 auto 30px;
            animation:spin 1s linear infinite;
        }

        @keyframes spin{
            to{transform:rotate(360deg)}
        }

        .pipeline{
            margin-top:30px;
            text-align:left;
            background:#020617;
            border-radius:18px;
            padding:24px;
            font-size:0.95rem;
        }

        .pipeline div{
            margin-bottom:8px;
        }

        /* =======================
           RESULTS
        ======================== */
        .results-header{
            text-align:center;
            margin:70px 0 30px;
        }

        .results-header h2{
            font-weight:800;
            font-size:2.6rem;
        }

        .results-header span{
            color:var(--secondary);
        }

        .clip-card{
            background:linear-gradient(180deg,#020617,#020617aa);
            border-radius:26px;
            padding:16px;
            box-shadow:0 30px 70px rgba(0,0,0,0.6);
            transition:.4s;
            border:1px solid rgba(255,255,255,0.08);
        }

        .clip-card:hover{
            transform:translateY(-8px);
            box-shadow:0 50px 120px rgba(34,211,238,0.25);
        }

        .badge-ai{
            display:inline-block;
            font-size:0.7rem;
            font-weight:700;
            padding:6px 14px;
            border-radius:999px;
            background:rgba(34,211,238,0.15);
            color:var(--secondary);
            margin-bottom:12px;
        }

        video{
            width:100%;
            aspect-ratio:9/16;
            border-radius:20px;
            background:black;
        }

        .download{
            display:block;
            margin-top:14px;
            padding:14px;
            text-align:center;
            font-weight:800;
            border-radius:16px;
            text-decoration:none;
            color:#020617;
            background:linear-gradient(90deg,var(--secondary),#60a5fa);
        }
    </style>
</head>

<body>

<!-- =======================
     HEADER
======================== -->
<header class="top-bar">
    <a href="index.html" class="back-btn">← Back to Home</a>
    <div class="brand">CLIPGEN <span>AI</span></div>
</header>

<!-- =======================
     LOADING / STATUS
======================== -->
<div id="loader" class="status-card">
    <div class="loader"></div>
    <h2 id="status-text" style="font-weight:800">Booting AI Engine…</h2>
    <p class="text-muted">Analyzing frames and detecting peak moments.</p>

    <div class="pipeline">
        <div>✔ Frame Motion Analysis</div>
        <div class="text-muted">⏳ Peak Moment Detection</div>
        <div class="text-muted">⏳ 9:16 Vertical Clip Generation</div>
    </div>
</div>

<!-- =======================
     RESULTS HEADER
======================== -->
<div id="results-header" class="results-header d-none">
    <h2>AI <span>Results</span></h2>
    <p class="text-muted">Your clips are ready to download.</p>
</div>

<!-- =======================
     RESULTS GRID
======================== -->
<div id="results" class="container d-none">
    <div class="row g-4 justify-content-center"></div>
</div>

<!-- =======================
     SCRIPT
======================== -->
<script>
    // Read job ID from URL
    const params = new URLSearchParams(window.location.search);
    const jobId = params.get("job");

    // If no job ID exists
    if (!jobId) {
        document.body.innerHTML = `
            <div style="height:100vh;display:flex;align-items:center;justify-content:center;text-align:center">
                <div>
                    <h2 style="color:#22d3ee;font-weight:800">No Job Found</h2>
                    <p class="text-white">Please upload a video first.</p>
                    <a href="index.html" class="back-btn">Go Back</a>
                </div>
            </div>
        `;
        throw new Error("Missing Job ID");
    }

    // Map backend status to user-friendly text
    const labels = {
        starting:"Initializing AI…",
        processing:"Detecting Visual Peaks…",
        done:"Finalizing Clips…",
        error:"Processing Failed"
    };

    // Poll backend every 2.5 seconds
    const poller = setInterval(async () => {
        try{
            const res = await fetch(`http://127.0.0.1:8000/status/${jobId}`);
            const data = await res.json();

            document.getElementById("status-text").innerText =
                labels[data.status] || data.status;

            // Error state
            if(data.status === "error"){
                clearInterval(poller);
                document.getElementById("loader").innerHTML = `
                    <h2 style="color:red;font-weight:800">Processing Failed</h2>
                    <p class="text-muted">Unsupported or corrupted video.</p>
                    <a href="index.html" class="back-btn mt-3">Try Again</a>
                `;
            }

            // Success state
            if(data.status === "done"){
                clearInterval(poller);

                document.getElementById("loader").classList.add("d-none");
                document.getElementById("results-header").classList.remove("d-none");
                document.getElementById("results").classList.remove("d-none");

                const grid = document.querySelector("#results .row");

                grid.innerHTML = data.clips.map((clip,i)=>`
                    <div class="col-sm-6 col-md-4 col-lg-3">
                        <div class="clip-card">
                            <div class="badge-ai">AI CLIP #${i+1}</div>
                            <video src="${clip.url}" controls></video>
                            <a href="" download="Clip_${i+1}.mp4" class="download">
                                DOWNLOAD
                            </a>
                        </div>
                    </div>
                `).join("");
            }

        }catch(err){
            console.error(err);
        }
    }, 2500);
</script>

</body>
</html>
